#!/bin/bash
start_fn () {
	echo "Checking all resources..."
	main_fn
}
main_fn () {
	if [[ `which adb` ]]; then
	    echo "ADB installed.. starting daemon"
	    sleep 5
	    adb &> /dev/null 
	    auth_check="$(adb devices | grep 'unauthorized')"
	    if [[ -z "$auth_check" ]]; then
	    	echo "Running MantisBuddy..."
			list_devices="$(adb devices)"
			new_var=($list_devices)
			echo "Device:" ${new_var[4]}
	    	adb -s ${new_var[4]}  shell sh /sdcard/Android/data/app.mantispro.gamepad/files/buddyNew.sh
	    	sleep 3
	    	echo "Activation Complete! Please Launch 'Mantis Gamepad Pro'"
	    	sleep 3
	    	exit
	    else
	    	echo "Please, Tap Allow button on device\'s USB Debugging "
	    	sleep 3
	    	adb disconnect && adb kill-server
	    	start_fn
	    fi
	else
		echo "Installing ADB resources..."
		apt-get update -y  &> /dev/null ; apt-get install android-tools -y &> /dev/null
		echo "Done."
		start_fn
	fi	
}
main_fn
